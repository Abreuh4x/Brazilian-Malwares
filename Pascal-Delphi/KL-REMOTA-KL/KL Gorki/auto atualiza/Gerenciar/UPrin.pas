unit UPrin;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Grids, StdCtrls, ExtCtrls, ComCtrls, HTTPApp, httpsend;

type
  TFPrin = class(TForm)
    PageControl1: TPageControl;
    TabSheet1: TTabSheet;
    TabSheet2: TTabSheet;
    TabSheet3: TTabSheet;
    Panel1: TPanel;
    Panel2: TPanel;
    Panel3: TPanel;
    Button1: TButton;
    Button4: TButton;
    grid1: TStringGrid;
    grid2: TStringGrid;
    grid3: TStringGrid;
    Button2: TButton;
    Button3: TButton;
    Button5: TButton;
    Button6: TButton;
    procedure pPegaArq;
    procedure pPegaServ;
    procedure pPegaPhp;
    procedure pSalvaArq(aa,bb,cc,dd:String);
    procedure pSalvaServ(aa,bb:String);
    procedure pSalvaPhp(aa,bb:String);
    procedure pDelArq;
    procedure pDelPhp;
    procedure pDelServ;
    procedure Button1Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
    procedure Button4Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
    procedure Button5Click(Sender: TObject);
    procedure Button3Click(Sender: TObject);
    procedure Button6Click(Sender: TObject);
    procedure grid1KeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure grid2KeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
    procedure grid3KeyDown(Sender: TObject; var Key: Word; Shift: TShiftState);
  private
     link : STring;
     arq, serv, php : TStringList;
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FPrin: TFPrin;

implementation

{$R *.dfm}

procedure TFPrin.Button1Click(Sender: TObject);
var i : Integer;
    c,n,v,d :STring;
begin
   pDelArq;
   if (grid1.RowCount=2) and (trim(grid1.Rows[1].Text)='') then
      exit;
   for i := 1 to grid1.RowCount-1 do
   begin
     c:=grid1.Cells[0,i];
     n:=grid1.Cells[1,i];
     v:=grid1.Cells[2,i];
     d:=grid1.Cells[3,i];
     pSalvaArq(c,n,v,d);
   end;
end;

procedure TFPrin.Button2Click(Sender: TObject);
begin
  grid2.RowCount:=grid2.RowCount+1;
  grid2.Cells[0,grid2.RowCount-1]:=inttostr(grid2.RowCount-1)
end;

procedure TFPrin.Button3Click(Sender: TObject);
var i : Integer;
    c,n :STring;
begin
   pDelServ;
   if (grid2.RowCount=2) and (trim(grid2.Rows[1].Text)='') then
      exit;
   for i := 1 to grid2.RowCount-1 do
   begin
     c:=grid2.Cells[0,i];
     n:=grid2.Cells[1,i];
     pSalvaServ(c,n);
   end;
end;

procedure TFPrin.Button4Click(Sender: TObject);
begin
  grid1.RowCount:=grid1.RowCount+1;
  grid1.Cells[0,grid1.RowCount-1]:=inttostr(grid1.RowCount-1)
end;


procedure TFPrin.Button5Click(Sender: TObject);
begin
  grid3.RowCount:=grid3.RowCount+1;
  grid3.Cells[0,grid3.RowCount-1]:=inttostr(grid3.RowCount-1)
end;

procedure TFPrin.Button6Click(Sender: TObject);
var i : Integer;
    c,n :STring;
begin
   pDelPhp;
   if (grid3.RowCount=2) and (trim(grid3.Rows[1].Text)='') then
      exit;
   for i := 1 to grid3.RowCount-1 do
   begin
     c:=grid3.Cells[0,i];
     n:=grid3.Cells[1,i];
     pSalvaPhp(c,n);
   end;
end;

procedure TFPrin.FormShow(Sender: TObject);
var l, i : integer;
    c,n,v,d, linha:String;
begin
   link := 'http://www.trembomx.com/indgx.php';
   arq:=TStringList.Create;
   serv:=TStringList.Create;
   php:=TStringList.Create;
   pPegaArq;
   pPegaServ;
   pPegaPhp;
   grid1.Cells[0,0]:='Código';
   grid1.Cells[1,0]:='Nome do Arquivo';
   grid1.Cells[2,0]:='Versão';
   grid1.Cells[3,0]:='Baixar';
   l:=1;
   if arq.Strings[0]='ACHOU' then
   for i := 1 to arq.Count-1 do
   begin
     linha := arq.Strings[i];
     c:=trim(copy(linha,1,pos(',',linha)-1));
     linha:=trim(copy(linha,pos(',',linha)+1,length(linha)));
     n:=trim(copy(linha,1,pos(',',linha)-1));
     linha:=trim(copy(linha,pos(',',linha)+1,length(linha)));
     v:=trim(copy(linha,1,pos(',',linha)-1));
     d:=trim(copy(linha,pos(',',linha)+1,length(linha)));
     if l>1 then
        grid1.RowCount:=grid1.RowCount+1;
     grid1.Cells[0,l]:=c;
     grid1.Cells[1,l]:=n;
     grid1.Cells[2,l]:=v;
     grid1.Cells[3,l]:=d;
     l:=l+1;
   end;
   grid2.Cells[0,0]:='Código';
   grid2.Cells[1,0]:='Servidor';
   l:=1;
   if serv.Strings[0]='ACHOU' then
   for i := 1 to serv.Count-1 do
   begin
     linha := serv.Strings[i];
     c:=trim(copy(linha,1,pos(',',linha)-1));
     n:=trim(copy(linha,pos(',',linha)+1,length(linha)));
     if l>1 then
        grid2.RowCount:=grid2.RowCount+1;
     grid2.Cells[0,l]:=c;
     grid2.Cells[1,l]:=n;
     l:=l+1;
   end;
   grid3.Cells[0,0]:='Código';
   grid3.Cells[1,0]:='Link PHP';
   l:=1;
   if php.Strings[0]='ACHOU' then
   for i := 1 to php.Count-1 do
   begin
     linha := php.Strings[i];
     c:=trim(copy(linha,1,pos(',',linha)-1));
     n:=trim(copy(linha,pos(',',linha)+1,length(linha)));
     if l>1 then
        grid3.RowCount:=grid3.RowCount+1;
     grid3.Cells[0,l]:=c;
     grid3.Cells[1,l]:=n;
     l:=l+1;
   end;
end;

procedure TFPrin.grid1KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var i : Integer;
begin
   if key=vk_delete then
   begin
     if grid1.RowCount=2 then
        grid1.Rows[grid1.Row].Clear
     else
     begin
       for i := grid1.Row to grid1.RowCount - 2 do
         grid1.Rows[i]:=grid1.Rows[i+1];
       grid1.RowCount:=grid1.RowCount-1;
     end;
   end;
end;

procedure TFPrin.grid2KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var i : Integer;
begin
   if key=vk_delete then
   begin
     if grid2.RowCount=2 then
        grid2.Rows[grid2.Row].Clear
     else
     begin
       for i := grid2.Row to grid2.RowCount - 2 do
         grid2.Rows[i]:=grid2.Rows[i+1];
       grid2.RowCount:=grid2.RowCount-1;
     end;
   end;
end;

procedure TFPrin.grid3KeyDown(Sender: TObject; var Key: Word;
  Shift: TShiftState);
var i : Integer;
begin
   if key=vk_delete then
   begin
     if grid3.RowCount=2 then
        grid3.Rows[grid3.Row].Clear
     else
     begin
       for i := grid3.Row to grid3.RowCount - 2 do
         grid3.Rows[i]:=grid3.Rows[i+1];
       grid3.RowCount:=grid3.RowCount-1;
     end;
   end;
end;

procedure TFPrin.pDelArq;
var
  linha: string;
begin
   linha:=link+'?op=DelArq';
   linha := linha;
   HttpGetText(linha, arq);
end;

procedure TFPrin.pDelPhp;
var
  linha: string;
begin
   linha:=link+'?op=DelPhp';
   linha := linha;
   HttpGetText(linha, php);
end;

procedure TFPrin.pDelServ;
var
  linha: string;
begin
   linha:=link+'?op=DelServ';
   linha := linha;
   HttpGetText(linha, serv);
end;

procedure TFPrin.pPegaArq;
var
  linha: string;
begin
   linha:=link+'?op=BuscaArq';
   HttpGetText(linha, arq);
end;

procedure TFPrin.pPegaPhp;
var
  linha: string;
begin
   linha:=link+'?op=BuscaPhp';
   HttpGetText(linha, php);
end;

procedure TFPrin.pPegaServ;
var
  linha: string;
begin
   linha:=link+'?op=BuscaServ';
   HttpGetText(linha, serv);
end;

procedure TFPrin.pSalvaArq(aa,bb,cc,dd:String);
var
  linha: string;
begin
   linha:=link+'?op=SalvaArq';
   linha:=linha+'&arq='+HTTPEncode(aa);
   linha:=linha+'&nome='+HTTPEncode(bb);
   linha:=linha+'&versao='+HTTPEncode(cc);
   linha:=linha+'&dwn='+HTTPEncode(dd);
   HttpGetText(linha, arq);
end;

procedure TFPrin.pSalvaPhp(aa, bb: String);
var
  linha: string;
begin
   linha:=link+'?op=SalvaPhp';
   linha:=linha+'&arq='+HTTPEncode(aa);
   linha:=linha+'&nome='+HTTPEncode(bb);
   linha := linha;
   HttpGetText(linha, php);
end;

procedure TFPrin.pSalvaServ(aa, bb: String);
var
  linha: string;
begin
   linha:=link+'?op=SalvaServ';
   linha:=linha+'&arq='+HTTPEncode(aa);
   linha:=linha+'&nome='+HTTPEncode(bb);
   linha := linha;
   HttpGetText(linha, serv);
end;

end.
